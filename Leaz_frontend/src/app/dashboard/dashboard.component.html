<!-- File Upload Section -->
<div class="main-container">
  <div class="action-bar">
    <div class="upload-section">
      <div class="upload-card">
        <div class="upload-icon">
          <i class="fa-solid fa-arrow-down"></i>
        </div>
        <div class="file-info" *ngIf="firstDocument">
          <span class="file-name"><i class="fas fa-file-pdf"></i> {{ firstDocument.name }}</span>
          <span class="close-icon" (click)="removeFile('firstDocument')">
            <i class="fas fa-times"></i>
          </span>
        </div>
        <label class="browse-label" *ngIf="!firstDocument">Drop Older Version File
          <input type="file" (change)="onFileSelected('firstDocument',$event)" hidden accept=".pdf,.doc,.docx" />
        </label>
      </div>
      <div class="upload-card">
        <div class="upload-icon">
          <i class="fa-solid fa-arrow-down"></i>
        </div>
        <div class="file-info" *ngIf="secondDocument">
          <span class="file-name"><i class="fas fa-file-pdf"></i> {{ secondDocument.name }}</span>
          <span class="close-icon" (click)="removeFile('secondDocument')">
            <i class="fas fa-times"></i>
          </span>
        </div>
        <label class="browse-label" *ngIf="!secondDocument">Drop Newer Version File
          <input type="file" (change)="onFileSelected('secondDocument',$event)" hidden accept=".pdf,.doc,.docx" />
        </label>
      </div>
    </div>
    <div class="compare-button-wrapper">
      <button 
        class="compare-button" 
        (click)="onSubmit()" 
        [disabled]="!firstDocument || !secondDocument || isLoading"
        [class.loading]="isLoading">
        <span *ngIf="!isLoading">Compare</span>
        <span *ngIf="isLoading">
          <i class="fas fa-spinner fa-spin"></i> Analyzing...
        </span>
      </button>
    </div>
  </div>

  <!-- Error Message -->
  <div class="error-message" *ngIf="hasError">
    <i class="bi bi-exclamation-triangle"></i>
    {{ errorMessage }}
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <div class="loading-spinner">
      <i class="fas fa-cog fa-spin"></i>
    </div>
    <p>Analyzing documents with AI...</p>
  </div>

  <!-- Stats Grid - Show after analysis -->
  <div class="stats-grid" *ngIf="comparisonResult && !isLoading">
    <div class="stat-card">
      <div class="stat-header">
        <div class="stat-icon contracts">
          <i class="bi bi-file-earmark-text"></i>
        </div>
        <div class="stat-change positive">{{ overallChangePct }}%</div>
      </div>
      <div class="stat-value">{{ totalDifferences }}</div>
      <div class="stat-label">Total Changes</div>
    </div>
    <div class="stat-card">
      <div class="stat-header">
        <div class="stat-icon differences">
          <i class="bi bi-exclamation-triangle"></i>
        </div>
        <div class="stat-change negative">{{ criticalDifferences.length }}</div>
      </div>
      <div class="stat-value">{{ criticalDifferences.length }}</div>
      <div class="stat-label">Critical Differences</div>
    </div>
    <div class="stat-card">
      <div class="stat-header">
        <div class="stat-icon similarities">
          <i class="bi bi-plus-circle"></i>
        </div>
        <div class="stat-change positive">{{ addedClauses.length }}</div>
      </div>
      <div class="stat-value">{{ addedClauses.length }}</div>
      <div class="stat-label">Added Clauses</div>
    </div>
    <div class="stat-card">
      <div class="stat-header">
        <div class="stat-icon time">
          <i class="bi bi-dash-circle"></i>
        </div>
        <div class="stat-change negative">{{ removedClauses.length }}</div>
      </div>
      <div class="stat-value">{{ removedClauses.length }}</div>
      <div class="stat-label">Removed Clauses</div>
    </div>
  </div>

  <!-- Progress Container -->
  <div class="progress-container" *ngIf="isLoading || comparisonResult">
    <div class="progress-header">
      <span style="font-weight: 600; color: #1e293b;">AI Analysis Progress</span>
      <span style="color: #64748b; font-size: 14px;" *ngIf="firstDocument && secondDocument">
        Comparing {{ firstDocument.name }} vs {{ secondDocument.name }}
      </span>
    </div>
    <div class="progress-bar">
      <div class="progress-fill" [style.width.%]="analysisProgress"></div>
    </div>
    <div class="progress-text">{{ analysisProgress.toFixed(0) }}% Complete</div>
  </div>

  <!-- Results Section -->
  <div class="responsive-grid" *ngIf="comparisonResult && !isLoading">
    <div class="comparison-panel">
      <div class="panel-header">
        <div class="panel-title">Contract Comparison Results</div>
        <div class="panel-actions">
          <button class="icon-btn" (click)="onSubmit()" [disabled]="isLoading">
            <i class="bi bi-arrow-clockwise"></i>
          </button>
          <button class="icon-btn">
            <i class="bi bi-download"></i>
          </button>
          <button class="icon-btn">
            <i class="bi bi-three-dots"></i>
          </button>
        </div>
      </div>

      <!-- Document Info -->
      <div class="contract-list">
        <div class="contract-item" *ngIf="firstDocument">
          <div class="contract-icon">
            <i class="bi bi-file-earmark-pdf"></i>
          </div>
          <div class="contract-info">
            <div class="contract-name">{{ firstDocument.name }}</div>
            <div class="contract-meta">Original Document</div>
          </div>
          <div class="contract-status status-analyzed">Analyzed</div>
        </div>
        <div class="contract-item" *ngIf="secondDocument">
          <div class="contract-icon">
            <i class="bi bi-file-earmark-pdf"></i>
          </div>
          <div class="contract-info">
            <div class="contract-name">{{ secondDocument.name }}</div>
            <div class="contract-meta">Updated Document</div>
          </div>
          <div class="contract-status status-analyzed">Analyzed</div>
        </div>
      </div>

      <!-- Comparison Results -->
      <div class="comparison-results">
        <!-- Critical Differences -->
        <div class="result-section" *ngIf="criticalDifferences.length > 0">
          <div class="result-header">
            <div class="result-type-icon differences-icon">
              <i class="bi bi-exclamation-triangle"></i>
            </div>
            <div class="result-title">Critical Differences</div>
            <div class="result-count">{{ criticalDifferences.length }} Found</div>
          </div>
          <div class="result-items">
            <div class="result-item difference" *ngFor="let change of criticalDifferences">
              <div class="change-header">
                <strong>{{ change.term }}</strong>
                <span class="change-badge {{ getImpactClass(change.impact) }}">
                  <i class="{{ getChangeTypeIcon(change) }}"></i>
                  {{ getChangeTypeLabel(change) }}
                </span>
              </div>
              <div class="change-location">{{ change.sectionOrClauseId }}</div>
              <div class="change-content">
                <div class="old-text" *ngIf="change.oldClause">
                  <strong>Original:</strong> {{ change.oldClause }}
                </div>
                <div class="new-text" *ngIf="change.newClause">
                  <strong>Updated:</strong> {{ change.newClause }}
                </div>
              </div>
              <div class="change-percentage">{{ change.wordChangePct }}% change</div>
            </div>
          </div>
        </div>

        <!-- Minor Changes -->
        <div class="result-section" *ngIf="minorDifferences.length > 0">
          <div class="result-header">
            <div class="result-type-icon similarities-icon">
              <i class="bi bi-info-circle"></i>
            </div>
            <div class="result-title">Minor Changes</div>
            <div class="result-count">{{ minorDifferences.length }} Found</div>
          </div>
          <div class="result-items">
            <div class="result-item similarity" *ngFor="let change of minorDifferences">
              <div class="change-header">
                <strong>{{ change.term }}</strong>
                <span class="change-badge {{ getImpactClass(change.impact) }}">
                  <i class="{{ getChangeTypeIcon(change) }}"></i>
                  {{ getChangeTypeLabel(change) }}
                </span>
              </div>
              <div class="change-location">{{ change.sectionOrClauseId }}</div>
              <div class="change-content">
                <div class="old-text" *ngIf="change.oldClause">
                  <strong>Original:</strong> {{ change.oldClause }}
                </div>
                <div class="new-text" *ngIf="change.newClause">
                  <strong>Updated:</strong> {{ change.newClause }}
                </div>
              </div>
              <div class="change-percentage">{{ change.wordChangePct }}% change</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- AI Insights -->
    <div class="ai-insights">
      <div class="ai-header">
        <div class="ai-avatar">
          <i class="bi bi-robot"></i>
        </div>
        <div class="ai-info">
          <h3>AI Legal Assistant</h3>
          <p>Analysis complete</p>
        </div>
      </div>
      <div class="insights-content">
        <!-- Overall Summary -->
        <div class="insight-card summary" *ngIf="overallSummary">
          <div class="insight-title">
            <i class="bi bi-file-text"></i>
            Overall Summary
          </div>
          <div class="insight-text">
            {{ overallSummary }}
          </div>
        </div>

        <!-- Critical Risk Alert -->
        <div class="insight-card critical" *ngIf="criticalDifferences.length > 0">
          <div class="insight-title">
            <i class="bi bi-exclamation-triangle-fill"></i>
            Critical Changes Detected
          </div>
          <div class="insight-text">
            {{ criticalDifferences.length }} critical differences found that require immediate attention. 
            Review these changes carefully as they may significantly impact the contract terms.
          </div>
        </div>

        <!-- Change Statistics -->
        <div class="insight-card recommendation">
          <div class="insight-title">
            <i class="bi bi-graph-up"></i>
            Change Analysis
          </div>
          <div class="insight-text">
            Overall document change: {{ overallChangePct.toFixed(1) }}%. 
            {{ addedClauses.length }} clauses added, {{ removedClauses.length }} removed, 
            {{ modifiedClauses.length }} modified.
          </div>
        </div>

        <!-- Recommendations based on changes -->
        <div class="insight-card warning" *ngIf="removedClauses.length > 0">
          <div class="insight-title">
            <i class="bi bi-shield-exclamation"></i>
            Removed Clauses Alert
          </div>
          <div class="insight-text">
            {{ removedClauses.length }} clauses have been removed from the original document. 
            Ensure these removals are intentional and don't create legal gaps.
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
